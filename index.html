<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ç»ˆæœ«åœ°åŸºè´¨è§„åˆ’å™¨ (Endfield Essence Planner)</title>
    <meta
      name="description"
      content="ç»ˆæœ«åœ°åŸºè´¨è§„åˆ’å™¨ï¼šæ ¹æ®é™„åŠ /æŠ€èƒ½å±æ€§æ± ä¸é”å®šè§„åˆ™ï¼Œè‡ªåŠ¨è®¡ç®—å¤šæ­¦å™¨å…±åˆ·æ–¹æ¡ˆï¼Œæä¾›åŸºç¡€å±æ€§å†²çªæç¤ºä¸å¯åˆ·æ•°é‡å‚è€ƒï¼Œé€‚é…ç§»åŠ¨ç«¯ã€‚"
    />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://end.canmoe.com/" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="ç»ˆæœ«åœ°åŸºè´¨è§„åˆ’å™¨ (Endfield Essence Planner)" />
    <meta
      property="og:description"
      content="ç»ˆæœ«åœ°åŸºè´¨è§„åˆ’å™¨ï¼šæ ¹æ®é™„åŠ /æŠ€èƒ½å±æ€§æ± ä¸é”å®šè§„åˆ™ï¼Œè‡ªåŠ¨è®¡ç®—å¤šæ­¦å™¨å…±åˆ·æ–¹æ¡ˆï¼Œæä¾›åŸºç¡€å±æ€§å†²çªæç¤ºä¸å¯åˆ·æ•°é‡å‚è€ƒï¼Œé€‚é…ç§»åŠ¨ç«¯ã€‚"
    />
    <meta property="og:url" content="https://end.canmoe.com/" />
    <meta property="og:site_name" content="ç»ˆæœ«åœ°åŸºè´¨è§„åˆ’å™¨" />
    <meta name="twitter:card" content="summary" />
    <link rel="icon" href="./favicon.ico" sizes="any" />
    <link rel="icon" href="./favicon-002.ico" sizes="32x32" />
    <link rel="icon" href="./favicon-003.ico" sizes="48x48" />
    <link rel="icon" href="./favicon-003.ico" sizes="64x64" />
    <link rel="icon" type="image/png" href="./favicon.png" />
    <!-- æœ¬åœ°ä¾èµ–ï¼ˆè¯·å°†æ–‡ä»¶æ”¾åˆ° ./vendor/ï¼‰ -->
    <link rel="stylesheet" href="./vendor/tailwind.min.css" />
    <script
      defer
      src="https://umami.canmoe.com/umcmx.js"
      data-website-id="98084554-f35b-4100-8bd4-262f490c9ae2"
    ></script>
    <script>
      (function () {
        const version = (document.lastModified || String(Date.now())).replace(/\D/g, "");
        document.documentElement.dataset.assetVersion = version;
        const link = document.createElement("link");
        link.rel = "stylesheet";
        link.href = "./styles.css?v=" + version;
        document.head.appendChild(link);
      })();
    </script>

  </head>
  <body>
    <div id="app" class="app-shell" v-cloak v-show="appReady">
      <header class="hero">
        <div>
          <h1>ç»ˆæœ«åœ°åŸºè´¨è§„åˆ’å™¨</h1>
          <p>
            æ ¹æ® <span class="accent">é™„åŠ /æŠ€èƒ½å±æ€§æ± </span> ä¸ <span class="accent">é”å®šè§„åˆ™</span> è‡ªåŠ¨åˆ¤å®šå…±åˆ·æ–¹æ¡ˆã€‚
            åŸºç¡€å±æ€§ä»…å¯ä¸‰é€‰ï¼Œç³»ç»Ÿä¼šç»™å‡ºå†²çªæç¤ºä¸æ¨èä¸‰é€‰ã€‚
          </p>
        </div>
        <div class="hero-actions">
          <button class="about-button notice-button" @click="openNotice">å…¬å‘Š</button>
          <button class="about-button" @click="showChangelog = true">æ›´æ–°æ—¥å¿—</button>
          <button class="about-button" @click="showAbout = true">å…³äº</button>
          <div class="secondary-menu">
            <button class="ghost-button menu-toggle" @click="showSecondaryMenu = !showSecondaryMenu">
              æ›´å¤šè®¾ç½®
            </button>
            <div v-if="showSecondaryMenu" class="secondary-panel">
              <div class="secondary-item">
                <div class="secondary-label">æ€§èƒ½æ¨¡å¼</div>
                <select class="secondary-select" :value="perfPreference" @change="setPerfMode($event.target.value)">
                  <option value="auto">è‡ªåŠ¨</option>
                  <option value="standard">æ ‡å‡†</option>
                  <option value="low">ä½GPU</option>
                </select>
                <div v-if="perfPreference === 'auto'" class="secondary-hint">
                  å½“å‰è‡ªåŠ¨ï¼š{{ lowGpuEnabled ? "ä½GPU" : "æ ‡å‡†" }}
                </div>
              </div>
              <div class="secondary-item secondary-desc">
                è‡ªåŠ¨æ¨¡å¼ä¼šæ ¹æ®æ¸²æŸ“æ€§èƒ½ä¸´æ—¶åˆ‡æ¢ä½GPUæ¨¡å¼ã€‚
              </div>
            </div>
          </div>
        </div>
      </header>
      <div v-if="lowGpuEnabled" class="perf-status">
        <div class="perf-status-text">
          ä½GPUæ¨¡å¼å·²å¼€å¯{{ perfPreference === "auto" ? "ï¼ˆè‡ªåŠ¨ï¼‰" : "ï¼ˆæ‰‹åŠ¨ï¼‰" }}
        </div>
        <button class="ghost-button" @click.stop="showSecondaryMenu = true">æ›´å¤šè®¾ç½®</button>
      </div>
      <div v-if="showPerfNotice" class="perf-notice">
        <div class="perf-notice-text">
          æ£€æµ‹åˆ°å½“å‰æ¸²æŸ“æ€§èƒ½è¾ƒä½ï¼Œå·²è‡ªåŠ¨åˆ‡æ¢åˆ°ä½GPUæ¨¡å¼ä»¥æå‡æ»šåŠ¨æµç•…åº¦ï¼ˆå¯åœ¨â€œæ›´å¤šè®¾ç½®â€è°ƒæ•´ï¼‰ã€‚
        </div>
        <div class="perf-notice-actions">
          <button class="ghost-button" @click="setPerfMode('standard')">æ¢å¤æ•ˆæœ</button>
          <button class="about-button perf-keep" @click="setPerfMode('low')">ä¿æŒä½GPU</button>
        </div>
      </div>

      <main class="layout">
        <div class="mobile-tabs">
          <button
            class="mobile-tab"
            :class="{ active: mobilePanel === 'weapons' }"
            @click="mobilePanel = 'weapons'"
          >
            æ­¦å™¨é€‰æ‹© <span class="count">{{ selectedNames.length }}</span>
          </button>
          <button
            class="mobile-tab"
            :class="{ active: mobilePanel === 'plans' }"
            @click="mobilePanel = 'plans'"
          >
            æ–¹æ¡ˆæ¨è <span class="count">{{ recommendations.length }}</span>
          </button>
        </div>
        <div class="mobile-hint">æ‰‹æœºç«¯å¯é€šè¿‡ä¸Šæ–¹æ ‡ç­¾åˆ‡æ¢â€œæ­¦å™¨é€‰æ‹© / æ–¹æ¡ˆæ¨èâ€ã€‚</div>
        <section class="panel" :class="{ 'panel-hidden': mobilePanel !== 'weapons' }">
          <div class="panel-title">
            <h2>æ­¦å™¨é€‰æ‹©å™¨</h2>
            <button class="ghost-button" @click="clearSelection" :disabled="!selectedNames.length">
              æ¸…ç©º
            </button>
          </div>

          <div class="search-box">
            <span>ğŸ”</span>
            <input v-model="searchQuery" placeholder="æœç´¢æ­¦å™¨ / å±æ€§..." />
          </div>

          <div class="filter-toolbar">
            <button
              class="ghost-button"
              :class="{ 'is-active': showWeaponAttrs }"
              @click="showWeaponAttrs = !showWeaponAttrs"
            >
              {{ showWeaponAttrs ? "éšè—å±æ€§/æ’é™¤/å¤‡æ³¨ç®¡ç†" : "æ˜¾ç¤ºå±æ€§/æ’é™¤/å¤‡æ³¨ç®¡ç†" }}
            </button>
            <button class="ghost-button" @click="showFilterPanel = !showFilterPanel">
              {{ showFilterPanel ? "æŠ˜å å±æ€§ç­›é€‰" : "å±•å¼€å±æ€§ç­›é€‰" }}
            </button>
            <button
              class="ghost-button"
              :disabled="!hasAttributeFilters"
              @click="clearAttributeFilters"
            >
              æ¸…ç©ºå±æ€§ç­›é€‰
            </button>
          </div>
          <div class="filter-panel" :class="{ 'is-collapsed': !showFilterPanel }">
            <div class="filter-group">
              <div class="filter-title">åŸºç¡€å±æ€§</div>
              <div class="filter-chips">
                <button
                  v-for="value in s1Options"
                  :key="value"
                  class="filter-chip"
                  :class="{ 'is-active': filterS1.includes(value) }"
                  @click="toggleFilterValue('s1', value)"
                >
                  {{ formatS1(value) }}
                </button>
              </div>
            </div>
            <div class="filter-group">
              <div class="filter-title">é™„åŠ å±æ€§</div>
              <div class="filter-chips">
                <button
                  v-for="value in s2Options"
                  :key="value"
                  class="filter-chip"
                  :class="{ 'is-active': filterS2.includes(value) }"
                  @click="toggleFilterValue('s2', value)"
                >
                  {{ value }}
                </button>
              </div>
            </div>
            <div class="filter-group">
              <div class="filter-title">æŠ€èƒ½å±æ€§</div>
              <div class="filter-chips">
                <button
                  v-for="value in s3Options"
                  :key="value"
                  class="filter-chip"
                  :class="{ 'is-active': filterS3.includes(value) }"
                  @click="toggleFilterValue('s3', value)"
                >
                  {{ value }}
                </button>
              </div>
            </div>
          </div>

          <div class="tag-row">
            <span v-if="!selectedNames.length" class="tag">æœªé€‰æ‹©ä»»ä½•æ­¦å™¨</span>
            <span
              v-for="weapon in selectedWeaponRows"
              :key="weapon.name"
              class="tag"
              :class="{ 'is-excluded': weapon.isExcluded }"
              :title="weapon.note ? `å¤‡æ³¨ï¼š${weapon.note}` : ''"
            >
              {{ weapon.name }}
              <span v-if="weapon.isExcluded" class="tag-note">æ’é™¤</span>
              <button @click.stop="toggleWeapon(weapon)">âœ•</button>
            </span>
          </div>

          <div v-if="!showWeaponAttrs" class="weapon-list">
            <div
              v-for="weapon in filteredWeapons"
              :key="weapon.name"
              class="weapon-item"
              :class="{
                'is-selected': selectedNameSet.has(weapon.name),
                'is-excluded': isExcluded(weapon.name),
                'rarity-6': weapon.rarity === 6,
                'rarity-5': weapon.rarity === 5,
              }"
              @click="toggleWeapon(weapon)"
            >
              <div class="weapon-art">
                <img
                  v-if="hasImage(weapon)"
                  class="weapon-figure"
                  :src="weaponImageSrc(weapon)"
                  :alt="weapon.name"
                />
                <span v-else class="weapon-fallback-large">{{ weapon.rarity }}â˜…</span>
              </div>
              <div class="weapon-band"></div>
              <div class="weapon-name">{{ weapon.name }}</div>
            </div>
          </div>

          <div v-else class="weapon-attr-list">
            <div
              v-for="weapon in filteredWeapons"
              :key="weapon.name"
              class="scheme-weapon-item weapon-attr-item"
              :class="{
                'is-selected': selectedNameSet.has(weapon.name),
                'is-excluded': isExcluded(weapon.name),
              }"
              @click="toggleWeapon(weapon)"
            >
              <div class="scheme-weapon-title">
                <div
                  class="weapon-mini"
                  :style="rarityBadgeStyle(weapon.rarity, hasImage(weapon))"
                >
                  <img v-if="hasImage(weapon)" :src="weaponImageSrc(weapon)" :alt="weapon.name" />
                  <span v-else class="weapon-fallback">{{ weapon.rarity }}â˜…</span>
                </div>
                <span>{{ weapon.name }}</span>
                <span class="rarity" :style="rarityTextStyle(weapon.rarity)">
                  {{ weapon.rarity }}â˜…
                </span>
                <span class="badge" v-if="selectedNameSet.has(weapon.name)">å·²é€‰</span>
                <span class="badge muted" v-if="isExcluded(weapon.name)">æ’é™¤</span>
              </div>
              <div class="scheme-weapon-attrs">
                <span class="attr-value attr-type">{{ weapon.type }}</span>
                <span
                  class="attr-value"
                  :class="{ 'base-lock': filterS1.length && filterS1.includes(weapon.s1) }"
                >
                  {{ formatS1(weapon.s1) }}
                </span>
                <span
                  class="attr-value"
                  :class="{ locked: filterS2.length && filterS2.includes(weapon.s2) }"
                >
                  {{ weapon.s2 }}
                </span>
                <span
                  class="attr-value"
                  :class="{ locked: filterS3.length && filterS3.includes(weapon.s3) }"
                >
                  {{ weapon.s3 }}
                </span>
              </div>
              <div class="weapon-exclude-row" @click.stop>
                <button
                  class="exclude-toggle small"
                  :class="{ active: isExcluded(weapon.name) }"
                  @click.stop="toggleExclude(weapon)"
                >
                  {{ isExcluded(weapon.name) ? "å–æ¶ˆæ’é™¤" : "æ ‡è®°æ’é™¤" }}
                </button>
                <input
                  class="exclude-note-input"
                  :class="{ 'is-excluded': isExcluded(weapon.name) }"
                  type="text"
                  maxlength="30"
                  placeholder="å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰"
                  :value="getWeaponNote(weapon.name)"
                  @input="updateWeaponNote(weapon, $event.target.value)"
                />
              </div>
            </div>
          </div>
        </section>

        <section class="panel" :class="{ 'panel-hidden': mobilePanel !== 'plans' }">
          <div class="panel-title">
            <h2>æ–¹æ¡ˆæ¨èåˆ—è¡¨</h2>
            <div class="panel-actions">
              <div class="pill">å·²é€‰ {{ selectedWeapons.length }} æŠŠ</div>
              <button
                v-if="extraRecommendations.length"
                class="ghost-button"
                @click="showAllSchemes = !showAllSchemes"
              >
                {{ showAllSchemes ? "æ”¶èµ·å…¶ä»–æ–¹æ¡ˆ" : `å±•å¼€å…¶ä»–æ–¹æ¡ˆï¼ˆ${extraRecommendations.length}ï¼‰` }}
              </button>
            </div>
          </div>

          <div v-if="!selectedWeapons.length" class="empty">
            è¯·é€‰æ‹©è‡³å°‘ä¸€æŠŠæ­¦å™¨ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨æ¨èå¯å…±åˆ·çš„å‰¯æœ¬æ–¹æ¡ˆã€‚
          </div>

          <div v-else-if="!recommendations.length" class="recommendations">
            <div class="card">
              <div class="card-header">
                <div>
                  <div class="card-title">å½“å‰ç»„åˆæ— å¯ç”¨æ–¹æ¡ˆ</div>
                  <div class="hint">é™„åŠ /æŠ€èƒ½å±æ€§æ— æ³•ç»Ÿä¸€é”å®šï¼Œæˆ–å‰¯æœ¬æ± ä¸è¦†ç›–æ‰€éœ€è¯æ¡ã€‚</div>
                </div>
                <div class="strategy-row">
                  <span class="pill warn">è¯·æ‹†åˆ†æ‰¹æ¬¡åˆ·å–</span>
                </div>
              </div>

              <div class="lock-summary" v-if="fallbackPlan">
                <div class="lock-title">é”å®šæ–¹æ¡ˆï¼ˆä»…æ˜¾ç¤ºå†²çªæç¤ºï¼‰</div>
                <div class="lock-items">
                  <span class="lock-chip" :class="{ warn: fallbackPlan.baseOverflow }">
                    {{ fallbackPlan.baseOverflow ? "åŸºç¡€å±æ€§å†²çª" : "åŸºç¡€å±æ€§" }}ï¼š
                    {{
                      (fallbackPlan.baseOverflow ? fallbackPlan.baseAllLabels : fallbackPlan.basePickLabels).join(
                        " / "
                      )
                    }}
                  </span>
                  <span class="lock-chip warn" v-if="fallbackPlan.s2Conflict">
                    é™„åŠ å±æ€§å†²çªï¼ˆæ— æ³•ç»Ÿä¸€é”å®šï¼‰
                  </span>
                  <span class="lock-chip warn" v-if="fallbackPlan.s3Conflict">
                    æŠ€èƒ½å±æ€§å†²çªï¼ˆæ— æ³•ç»Ÿä¸€é”å®šï¼‰
                  </span>
                </div>
              </div>

              <div class="hint">å·²é€‰æ­¦å™¨ï¼ˆå†²çªé¡¹æ ‡çº¢ï¼‰</div>
              <div class="scheme-weapon-list">
                <div
                  v-for="weapon in fallbackPlan.weaponRows"
                  :key="weapon.name"
                  class="scheme-weapon-item is-selected"
                >
                  <div class="scheme-weapon-title">
                    <span>{{ weapon.name }}</span>
                    <span class="rarity" :style="rarityTextStyle(weapon.rarity)">
                      {{ weapon.rarity }}â˜…
                    </span>
                    <span class="badge">å·²é€‰</span>
                  </div>
                  <div class="scheme-weapon-attrs">
                    <span class="attr-value attr-type">ç±»å‹ï¼š{{ weapon.type }}</span>
                    <span
                      class="attr-value"
                      :class="{
                        'base-lock': weapon.baseLocked,
                        conflict: weapon.baseConflict,
                      }"
                    >
                      åŸºç¡€å±æ€§ï¼š{{ formatS1(weapon.s1) }}
                    </span>
                    <span class="attr-value" :class="{ conflict: fallbackPlan.s2Conflict }">
                      é™„åŠ å±æ€§ï¼š{{ weapon.s2 }}
                    </span>
                    <span class="attr-value" :class="{ conflict: fallbackPlan.s3Conflict }">
                      æŠ€èƒ½å±æ€§ï¼š{{ weapon.s3 }}
                    </span>
                  </div>
                  <div
                    v-if="getWeaponNote(weapon.name)"
                    class="exclude-note-text"
                    :class="{ 'is-excluded': isExcluded(weapon.name) }"
                  >
                    å¤‡æ³¨ï¼š{{ getWeaponNote(weapon.name) }}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div v-else class="recommendations">
            <div v-if="coverageSummary && coverageSummary.hasGap" class="card">
              <div class="card-header">
                <div>
                  <div class="card-title">å½“å‰ç»„åˆéœ€è¦åˆ†æ‰¹åˆ·å–</div>
                  <div class="hint">
                    è¯¥ç»„åˆæ— æ³•åœ¨åŒä¸€æ‰¹æ¬¡å®Œæˆï¼Œå·²ç”Ÿæˆ {{ recommendations.length }} å¥—æ–¹æ¡ˆè¦†ç›–å…¨éƒ¨å·²é€‰æ­¦å™¨ï¼Œ
                    å¹¶æŒ‰æ•ˆç‡ä¼˜å…ˆæ’åºï¼Œè¯·åœ¨ä¸‹æ–¹æŸ¥çœ‹ã€‚å¦‚éœ€æŸ¥çœ‹æ›´å¤šæ–¹æ¡ˆè¯·ç‚¹å‡»å±•å¼€å…¶ä»–æ–¹æ¡ˆæŒ‰é’®ã€‚
                  </div>
                </div>
                <div class="strategy-row">
                  <span class="pill warn">éœ€åˆ†æ‰¹æ¬¡åˆ·å–</span>
                </div>
              </div>
            </div>
            <div v-for="card in visibleRecommendations" :key="card.schemeKey" class="card">
              <div class="card-header">
                <div>
                  <div class="card-title">{{ card.dungeon.name }}</div>
                  <div class="hint" v-if="card.displaySelectedMatchCount === selectedWeapons.length">
                    é™„åŠ å±æ€§æ±  / æŠ€èƒ½å±æ€§æ±  å‡å·²æ»¡è¶³æ‰€é€‰æ­¦å™¨éœ€æ±‚
                  </div>
                  <div class="hint" v-else>
                    å·²è¦†ç›– {{ card.displaySelectedMatchCount }} / {{ selectedWeapons.length }} æŠŠå·²é€‰æ­¦å™¨ï¼Œå‰©ä½™éœ€æ‹†åˆ†åˆ·å–ã€‚
                  </div>
                  <details
                    v-if="card.displaySelectedMissingNames.length"
                    class="missing-details"
                    :open="selectedWeapons.length > 1"
                  >
                    <summary>æœªè¦†ç›– {{ card.displaySelectedMissingNames.length }} æŠŠ</summary>
                    <div class="missing-tags">
                      <span
                        v-for="name in card.displaySelectedMissingNames"
                        :key="name"
                        class="missing-tag"
                      >
                        {{ name }}
                      </span>
                    </div>
                  </details>
                </div>
                <div class="strategy-row">
                  <span class="pill wide">
                    å¯åŒæ—¶åˆ·æ­¦å™¨ï¼š{{ card.displayWeaponCount }} æŠŠï¼ˆè¦†ç›–å·²é€‰ {{ card.displaySelectedMatchCount }} æŠŠï¼‰
                  </span>
                  <span class="pill" v-if="card.maxWeaponCount !== card.displayWeaponCount">
                    æœ€å¤šå¯åˆ·ï¼š{{ card.maxWeaponCount }} æŠŠ
                  </span>
                  <span class="pill warn" v-if="card.displaySelectedMissingNames.length">
                    æœªè¦†ç›– {{ card.displaySelectedMissingNames.length }}
                  </span>
                </div>
              </div>
              <div class="lock-summary">
                <div class="lock-title">é”å®šæ–¹æ¡ˆ</div>
                <div class="lock-items">
                  <span
                    class="lock-chip"
                    :class="{ warn: card.manualPickNeeded || card.manualPickOverflow }"
                  >
                    åŸºç¡€å±æ€§ï¼š{{ card.basePickLabels.join(" / ") }}
                  </span>
                  <span class="lock-chip attr">é”å®š{{ card.lockLabel }}ï¼š{{ card.lockValue }}</span>
                </div>
                <div
                  class="hint"
                  v-if="card.baseOverflow"
                  :class="{ 'status-warn': card.manualPickOverflow }"
                >
                  <span v-if="card.manualPickOverflow">
                    å·²é€‰æ‹©è¶…è¿‡ä¸‰ç§åŸºç¡€å±æ€§ï¼Œè¯·æ‹†åˆ†å¹¶æ”¾å¼ƒä¸€ç§å±æ€§ã€‚
                  </span>
                  <span v-else-if="card.manualPickNeeded">
                    åŸºç¡€å±æ€§è¶…è¿‡ä¸‰é€‰ï¼Œè¯·åœ¨ä¸‹æ–¹ç‚¹å‡»æ­¦å™¨é€‰æ‹©ä½ æƒ³è¦åˆ·å–çš„åŸºç¡€å±æ€§ï¼ˆè¿˜éœ€é€‰æ‹©
                    {{ card.manualPickNeeded }} ä¸ªï¼‰
                  </span>
                  <span v-else>åŸºç¡€å±æ€§å·²é”å®šï¼Œå¯åŒæ—¶åˆ·èŒƒå›´å·²æ›´æ–°ã€‚</span>
                </div>
              </div>

              <div class="scheme-weapon-list">
                <div
                  v-for="weapon in card.weaponRows"
                  :key="weapon.name"
                  class="scheme-weapon-item"
                  :class="{
                    'is-selected': weapon.isSelected,
                    'base-selectable': card.baseOverflow,
                    'is-dim': weapon.baseDim || weapon.isExcluded,
                    'is-excluded': weapon.isExcluded,
                  }"
                  :title="card.baseOverflow ? 'ç‚¹å‡»é€‰æ‹©åŸºç¡€å±æ€§' : ''"
                  @click="toggleSchemeBasePick(card, weapon)"
                >
                  <div class="scheme-weapon-title">
                    <div class="weapon-mini" :style="rarityBadgeStyle(weapon.rarity, hasImage(weapon))">
                      <img v-if="hasImage(weapon)" :src="weaponImageSrc(weapon)" :alt="weapon.name" />
                      <span v-else class="weapon-fallback">{{ weapon.rarity }}â˜…</span>
                    </div>
                    <span>{{ weapon.name }}</span>
                    <span class="rarity" :style="rarityTextStyle(weapon.rarity)">
                      {{ weapon.rarity }}â˜…
                    </span>
                    <span v-if="weapon.isSelected" class="badge">å·²é€‰</span>
                    <span v-if="weapon.isExcluded" class="badge muted">æ’é™¤</span>
                  </div>
                  <div class="scheme-weapon-attrs">
                    <span class="attr-value attr-type">ç±»å‹ï¼š{{ weapon.type }}</span>
                    <span
                      class="attr-value"
                      :class="{ 'base-lock': weapon.baseLocked, conflict: weapon.baseConflict }"
                    >
                      åŸºç¡€å±æ€§ï¼š{{ formatS1(weapon.s1) }}
                    </span>
                    <span class="attr-value" :class="{ locked: card.lockType === 's2' }">
                      é™„åŠ å±æ€§ï¼š{{ weapon.s2 }}
                    </span>
                    <span class="attr-value" :class="{ locked: card.lockType === 's3' }">
                      æŠ€èƒ½å±æ€§ï¼š{{ weapon.s3 }}
                    </span>
                  </div>
                  <div v-if="weapon.note" class="exclude-note-text" :class="{ 'is-excluded': weapon.isExcluded }">
                    å¤‡æ³¨ï¼š{{ weapon.note }}
                  </div>
                </div>
              </div>

            </div>
            <div class="expand-row" v-if="extraRecommendations.length">
              <button class="ghost-button" @click="showAllSchemes = !showAllSchemes">
                {{ showAllSchemes ? "æ”¶èµ·å…¶ä»–æ–¹æ¡ˆ" : `å±•å¼€å…¶ä»–æ–¹æ¡ˆï¼ˆ${extraRecommendations.length}ï¼‰` }}
              </button>
            </div>
          </div>
        </section>
      </main>

      <transition name="fade-scale">
        <div v-if="showNotice" class="about-overlay notice-overlay" @click.self="closeNotice">
          <div class="about-card notice-card">
            <h3>{{ announcement.title }}</h3>
            <div class="notice-body">
              <p class="notice-meta">æ›´æ–°æ—¥æœŸï¼š{{ announcement.date }}</p>
              <ul class="notice-list">
                <li v-for="item in announcement.items" :key="item">{{ item }}</li>
              </ul>
            </div>
            <div class="notice-footer">
              <div class="notice-qq" v-if="announcement.qqGroup">
                <a
                  class="ghost-button notice-join"
                  href="https://qm.qq.com/q/FBNLBtEPy8"
                  target="_blank"
                  rel="noopener"
                >
                  åŠ å…¥ QQ ç¾¤
                </a>
                <div class="notice-qq-info">
                  QQ ç¾¤ï¼š{{ announcement.qqGroup }}
                  <span v-if="announcement.qqNote">ï¼ˆ{{ announcement.qqNote }}ï¼‰</span>
                </div>
              </div>
              <label class="notice-skip">
                <input type="checkbox" v-model="skipNotice" />
                æœ¬æ¬¡å…¬å‘Šä¸å†æ˜¾ç¤º
              </label>
              <div class="about-actions">
                <button class="ghost-button" @click="closeNotice">å…³é—­</button>
              </div>
            </div>
          </div>
        </div>
      </transition>

      <transition name="fade-scale">
        <div v-if="showChangelog" class="about-overlay" @click.self="showChangelog = false">
          <div class="about-card changelog-card">
            <h3>{{ changelog.title }}</h3>
            <div class="changelog-body">
              <div v-if="!changelog.entries || !changelog.entries.length" class="empty">
                æš‚æ— æ›´æ–°æ—¥å¿—ã€‚
              </div>
              <div
                v-else
                v-for="(entry, index) in changelog.entries"
                :key="entry.date || `changelog-${index}`"
                class="changelog-section"
              >
                <div class="changelog-date">{{ entry.date }}</div>
                <ul class="changelog-list">
                  <li v-for="item in entry.items" :key="item">{{ item }}</li>
                </ul>
              </div>
            </div>
            <div class="about-actions">
              <button class="ghost-button" @click="showChangelog = false">å…³é—­</button>
            </div>
          </div>
        </div>
      </transition>

      <transition name="fade-scale">
        <div v-if="showAbout" class="about-overlay" @click.self="showAbout = false">
          <div class="about-card">
            <h3>{{ aboutContent.title }}</h3>
            <p v-for="(line, index) in aboutContent.paragraphs" :key="`about-line-${index}`">
              {{ line }}
            </p>
            <p v-if="aboutContent.author">ä½œè€…ï¼š{{ aboutContent.author }}</p>
            <div class="about-links" v-if="aboutContent.links && aboutContent.links.length">
              <a
                v-for="link in aboutContent.links"
                :key="link.href || link.text"
                class="repo-link"
                :href="link.href"
                target="_blank"
                rel="noreferrer"
              >
                <span class="repo-chip">{{ link.chip }}</span>
                <span>{{ link.text }}</span>
                <span class="repo-arrow">â†—</span>
              </a>
            </div>
            <div class="about-thanks" v-if="aboutContent.thanks && aboutContent.thanks.length">
              <h4>æ„Ÿè°¢</h4>
              <ul class="about-thanks-list">
                <li
                  v-for="(entry, index) in aboutContent.thanks"
                  :key="entry.name || `about-thanks-${index}`"
                  class="about-thanks-item"
                >
                  <div class="about-thanks-name">
                    <a v-if="entry.href" :href="entry.href" target="_blank" rel="noreferrer">
                      {{ entry.name }}
                      <span class="about-thanks-arrow">â†—</span>
                    </a>
                    <span v-else>{{ entry.name }}</span>
                  </div>
                  <div v-if="entry.note" class="about-thanks-note">{{ entry.note }}</div>
                </li>
              </ul>
            </div>
            <div class="about-actions">
              <button class="ghost-button" @click="showAbout = false">å…³é—­</button>
            </div>
          </div>
        </div>
      </transition>

      <div v-if="showDomainWarning" class="domain-overlay">
        <div class="domain-card">
          <h3>éå®˜æ–¹åŸŸåæç¤º</h3>
          <p>
            å½“å‰è®¿é—®åŸŸåå¹¶é
            <a class="domain-link" href="https://end.canmoe.com" target="_blank" rel="noreferrer">
              end.canmoe.com
            </a>
            ï¼Œè¯·ç¡®è®¤æ˜¯å¦ä¸ºå¯ä¿¡æ¥æºï¼Œè°¨é˜²æ¶æ„æ˜ å°„æˆ–é¡µé¢è¢«å†…åµŒç¯¡æ”¹ã€‚
          </p>
          <p class="domain-chip">å½“å‰é¡µé¢åŸŸåï¼š{{ currentHost }}</p>
          <p v-if="isEmbedded" class="domain-chip">ä¸Šå±‚é¡µé¢åŸŸåï¼š{{ embedHostLabel }}</p>
          <p v-if="isEmbedded && !isEmbedTrusted">è¯¥åŸŸåæœªåœ¨å†…åµŒç™½åå•å†…ã€‚</p>
          <p v-if="isEmbedded">æ£€æµ‹åˆ°é¡µé¢è¢«å†…åµŒï¼ˆiframeï¼‰æ‰“å¼€ï¼Œæ­¤æç¤ºæ— æ³•å…³é—­ã€‚</p>
          <div class="about-actions domain-actions">
            <a
              class="repo-link domain-primary"
              href="https://end.canmoe.com"
              target="_blank"
              rel="noreferrer"
            >
              <span class="repo-chip">OFFICIAL</span>
              <span>è®¿é—®å®˜æ–¹åŸŸå</span>
              <span class="repo-arrow">â†—</span>
            </a>
            <button
              v-if="!isEmbedded"
              class="ghost-button"
              :disabled="warningCountdown > 0"
              @click="dismissDomainWarning"
            >
              {{ warningCountdown > 0 ? `æˆ‘å·²çŸ¥æ™“ï¼ˆ${warningCountdown}sï¼‰` : "æˆ‘å·²çŸ¥æ™“" }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      (function () {
        const version =
          document.documentElement.dataset.assetVersion ||
          (document.lastModified || String(Date.now())).replace(/\D/g, "");
        const scripts = [
          "./vendor/vue.global.prod.js",
          "./data/dungeons.js",
          "./data/weapons.js",
          "./data/weapon-images.js",
          "./data/content.js",
          "./app.js",
        ];
        const loadScript = (src) =>
          new Promise((resolve, reject) => {
            const script = document.createElement("script");
            script.src = src + "?v=" + version;
            script.onload = () => resolve();
            script.onerror = () => reject(new Error("Failed to load: " + src));
            document.body.appendChild(script);
          });
        scripts
          .reduce((chain, src) => chain.then(() => loadScript(src)), Promise.resolve())
          .catch(() => {
            document.body.innerHTML =
              "<div style='padding:24px;color:#f36c6c;font-family:Microsoft YaHei UI;'>èµ„æºåŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°æˆ–æ£€æŸ¥ç½‘ç»œç¼“å­˜ã€‚</div>";
          });
      })();
    </script>
  </body>
</html>
